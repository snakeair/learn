# 面向对象编程

## 对象的概念

`面向对象编程`缩写*OOP*，核心思想就是将我们程序中的各种复杂的关系抽象成为一个个对象，然后给对象分工合作。在面向对象中，每一个对象都是功能核心，具有明确分工，可以完成接受信息、处理数据、发出信息等任务。

对一个`对象`都是一个容器，封装了*属性*和*方法*。所谓属性就是对象状态；所谓方法就是对象行为。

## 构造函数

```javascript
var Vehicle = function () {
  this.price = 1000;
};
```

上面代码中`Vehicle`就是一个构造函数，它提供模板，用来生成对象实例。为了与普通函数区别，构造函数名字的第一个字母通常大写。

在典型的面向对象编程中存在`类`这个概念，所谓的类就是对象模板，对象就是类的实力。但是在JS中不是基于类的，而是基于`构造函数constructor`和`原型链prototype`的。

> 1. 函数体内部使用了`this`关键字，代表了所要生成的对象实例。
> 2. 生成对象的时候，必需用`new`命令，调用`Vehicle`函数。

## new命令

`new`的作用就是执行构造函数，返回一个实例对象。

```javascript
var Vehicle = function (p){
  this.price = p;
};

var v = new Vehicle(1000);
v.price // 1000
```

### new命令原理

在时候`new`的时候，它的工作步骤如下：

> 1. 创建一个空对象，作为将要返回的对象实例（如果对普通函数(没有`this`)使用`new`会返回一个空对象。）
> 2. 将这个空对象的原型，指向构造函数的`prototype`属性
> 3. 将这个空对象赋值给函数内部的`this`关键字
> 4. 开始执行构造函数内部的代码

也就是说，构造函数内部。`this`指的是一个新生成的空对象，所有针对this的操作都会发生在这个空对象上。构造函数之所以叫“构造函数”，就是说这个函数的目的，就是操作一个空对象（即`this`对象），将其“构造”为需要的样子。

如果构造函数内部有`return`语句，而且`return`后面跟着一个对象，`new`命令会返回`return`语句指定的对象；否则，就会不管`return`语句，返回`this`对象。

```javascript
var Vehicle = function () {
  this.price = 1000;
  return 1000;
};

(new Vehicle()) === 1000
// false
```

上面代码中，构造函数`Vehicle`的`return`语句返回一个数值。这时，`new`命令就会忽略这个`return`语句，返回“构造”后的`this`对象。

但是，如果`return`语句返回的是一个跟`this`无关的新对象，`new`命令会返回这个新对象，而不是`this`对象。这一点需要特别引起注意。

```javascript
var Vehicle = function (){
  this.price = 1000;
  return { price: 2000 };
};

(new Vehicle()).price
// 2000
```

上面代码中，构造函数`Vehicle`的`return`语句，返回的是一个新对象。`new`命令会返回这个对象，而不是`this`对象。



























